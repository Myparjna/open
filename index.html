<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HLS (m3u8) 播放支持检测页面</title>
    <!-- 引入 hls.js 库 -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 20px auto;
        padding: 0 15px;
        background-color: #f4f4f4;
      }
      .container {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2 {
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
        color: #1a1a1a;
      }
      #videoPlayer {
        width: 100%;
        max-width: 100%;
        background-color: #000;
        border-radius: 5px;
      }
      #results p {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        background-color: #e8f5e9; /* 浅绿色 */
        color: #2e7d32;
        border-left: 5px solid #4caf50;
      }
      .warning {
        background-color: #fff3e0; /* 浅橙色 */
        color: #e65100;
        border-left: 5px solid #ff9800;
      }
      .error {
        background-color: #ffebee; /* 浅红色 */
        color: #c62828;
        border-left: 5px solid #f44336;
      }
      code {
        background-color: #eee;
        padding: 2px 4px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>HLS (m3u8) 播放支持检测</h1>
      <p>
        此页面用于检测您的浏览器是否支持 HLS (HTTP Live Streaming)
        视频流播放。HLS 是苹果公司推出的流媒体协议，其索引文件格式为
        <code>.m3u8</code>，视频分片为 <code>.ts</code>。
      </p>
      <p>
        <strong>核心问题：</strong> 为什么移动端 Chrome 可能无法直接播放
        m3u8？因为 HLS 是苹果的标准，只有 Safari 和 iOS
        系统下的浏览器提供强大的原生支持。其他浏览器（如 Android/桌面版的
        Chrome, Firefox）则需要借助 JavaScript 库（如
        <code>hls.js</code>）来解析 m3u8 文件并播放。
      </p>

      <h2>检测结果</h2>
      <div id="results">
        <!-- 检测结果将动态插入这里 -->
      </div>

      <h2>视频播放测试</h2>
      <p>
        下方将尝试加载一个公开的 m3u8
        测试流。如果看到视频画面并能播放，则说明您的浏览器（通过原生或
        hls.js）具备播放能力。
      </p>
      <video id="videoPlayer" controls></video>

      <h2>结果解读与最终结论</h2>
      <div id="conclusion">
        <p>
          <strong>1. 如果“原生支持”为“支持”：</strong>
          恭喜！您的浏览器（很可能是 Safari）可以直接播放
          m3u8，无需任何额外工具。
        </p>
        <p>
          <strong
            >2. 如果“原生支持”为“不支持”，但“Hls.js 支持”为“支持”：</strong
          >
          这是最常见的情况，尤其是在 Chrome 和 Firefox
          上。这说明浏览器本身不直接解码
          m3u8，但它提供了必要的“媒体源扩展（MSE）”API，让
          <code>hls.js</code> 这样的库能够接管并完成播放。<strong
            >这是在非苹果浏览器上播放 m3u8 的标准解决方案。</strong
          >
        </p>
        <p>
          <strong>3. 如果两者都不支持：</strong>
          您可能在使用一个非常老旧或特殊的浏览器，它既没有原生 HLS
          支持，也不支持运行 <code>hls.js</code> 所需的
          MSE。在这种情况下，无法播放 HLS 视频。
        </p>
        <hr />
        <h4><strong>最终结论：</strong></h4>
        <p class="success">
          对于您提到的“移动端pad手机的chrome播放不了m3u8”的问题，原因正是因为
          Chrome 不提供原生 HLS 支持。<strong
            >解决方案就是在您的网页项目中集成 <code>hls.js</code> 库</strong
          >。这个页面本身就是一个最佳实践的例子：优先检测原生能力，如果不行，则自动启用
          <code>hls.js</code> 作为后备方案。
        </p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const resultsDiv = document.getElementById("results");
        const video = document.getElementById("videoPlayer");
        const m3u8Url = "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"; // 一个公开的、允许跨域的测试URL

        // --- 步骤 1: 检测原生支持 ---
        const pNative = document.createElement("p");
        // 'application/vnd.apple.mpegurl' 是HLS的官方MIME类型
        if (video.canPlayType("application/vnd.apple.mpegurl")) {
          pNative.innerHTML =
            "<strong>✅ 原生支持检测:</strong> 支持 (浏览器可以直接处理 m3u8)";
          pNative.className = "success";
        } else {
          pNative.innerHTML =
            "<strong>⚠️ 原生支持检测:</strong> 不支持 (这是 Chrome/Firefox 等浏览器的正常情况)";
          pNative.className = "warning";
        }
        resultsDiv.appendChild(pNative);

        // --- 步骤 2: 检测 Hls.js 支持 ---
        const pHlsjs = document.createElement("p");
        if (Hls.isSupported()) {
          pHlsjs.innerHTML =
            "<strong>✅ Hls.js 支持检测:</strong> 支持 (可以使用 JavaScript 库播放)";
          pHlsjs.className = "success";
        } else {
          pHlsjs.innerHTML =
            "<strong>❌ Hls.js 支持检测:</strong> 不支持 (浏览器缺少媒体源扩展 Media Source Extensions)";
          pHlsjs.className = "error";
        }
        resultsDiv.appendChild(pHlsjs);

        // --- 步骤 3: 根据检测结果尝试播放 ---
        const pPlayback = document.createElement("p");

        // 优先使用原生支持 (主要针对 Safari)
        if (video.canPlayType("application/vnd.apple.mpegurl")) {
          pPlayback.innerHTML =
            "<strong>播放方式:</strong> 正在使用浏览器原生 HLS 功能进行播放...";
          pPlayback.className = "success";
          video.src = m3u8Url;
          video.addEventListener("loadedmetadata", function () {
            console.log("视频元数据已加载（原生方式）");
          });
          // 如果原生不支持，但 hls.js 支持 (主要针对 Chrome, Firefox)
        } else if (Hls.isSupported()) {
          pPlayback.innerHTML =
            "<strong>播放方式:</strong> 正在使用 <code>hls.js</code> 库进行播放...";
          pPlayback.className = "success";
          const hls = new Hls();
          hls.loadSource(m3u8Url);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, function () {
            console.log("hls.js 已成功解析 m3u8 清单");
          });
          // 都不支持
        } else {
          pPlayback.innerHTML =
            "<strong>播放方式:</strong> 无法播放，浏览器既不原生支持HLS，也不兼容hls.js。";
          pPlayback.className = "error";
          video.poster =
            "data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22640%22%20height%3D%22360%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20360%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text/css%22%3E%23holder_18e95088d8b%20text%20%7B%20fill%3A%23AAAAAA%3Bfont-weight%3Abold%3Bfont-family%3AArial%2C%20Helvetica%2C%20Open%20Sans%2C%20sans-serif%2C%20monospace%3Bfont-size%3A32pt%20%7D%20%3C/style%3E%3C/defs%3E%3Cg%20id%3D%22holder_18e95088d8b%22%3E%3Crect%20width%3D%22640%22%20height%3D%22360%22%20fill%3D%22%23EEEEEE%22%3E%3C/rect%3E%3Cg%3E%3Ctext%20x%3D%22143.4921875%22%20y%3D%22195.2%22%3EHLS Not Supported%3C/text%3E%3C/g%3E%3C/g%3E%3C/svg%3E"; // 显示一个错误提示图
        }
        resultsDiv.appendChild(pPlayback);
      });
    </script>
  </body>
</html>
